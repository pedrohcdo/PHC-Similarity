<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PHC Similarity Pipeline</title>
<style>
    body {
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #f4f4f4;
        margin: 0;
    }
    .container, .list-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        background-color: #fff;
        padding: 20px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        border-radius: 8px;
        margin: 10px;
    }
    .horizontal {
        flex-direction: row;
        justify-content: center;
        width: 100%;
        overflow-x: auto;
    }
    .result, .list-item {
        margin-top: 10px;
        font-size: 1em;
        color: #333;
    }
    input[type="text"], input[type="range"], button, select {
        width: 100%;
    }
    #thresholdDisplay {
        text-align: center;
        font-weight: bold;
        margin: 20px;
        background-color: transparent;
        box-shadow: none;
    }
</style>
</head>
<body>
<div class="horizontal">
    <div class="container">
        <h3>Initial Words</h3>
        <input type="text" id="newWord" placeholder="Add new word">
        <button onclick="addWord()">Add Word</button>
        <div class="list-container" id="wordList">
            <!-- Initial words will be added by JavaScript -->
        </div>
    </div>
    
    <div class="container">
        <h3>Comparison Settings</h3>
        <input type="text" id="comparisonText" placeholder="Comparison text" value="strategicWord">
        <label for="penaltyClamp">Penalty Clamp: <span id="clampValue">3</span></label>
        <input type="range" id="penaltyClamp" min="1" max="10" value="3" oninput="document.getElementById('clampValue').textContent = value">
        <input type="text" id="penaltyFunction" value="x*2">
    </div>
    
    <div id="thresholdDisplay">
        Threshold: <input type="number" id="threshold" value="0.5" min="0" max="1" step="0.01">
    </div>
    
    <div class="container">
        <h3>Filtered Words</h3>
        <div class="list-container" id="filteredWords">
            <!-- Filtered words will appear here -->
        </div>
    </div>
</div>

<script>
const initialWords = ["strategicWord1", "strategicWord2", /* Add 28 more words */];
const wordList = document.getElementById('wordList');
const filteredWords = document.getElementById('filteredWords');

function addWord() {
    const newWord = document.getElementById('newWord').value;
    if (newWord) {
        initialWords.push(newWord);
        populateWordList();
        document.getElementById('newWord').value = ''; // Clear the input box
    }
}

function populateWordList() {
    wordList.innerHTML = '';
    initialWords.forEach(word => {
        const div = document.createElement('div');
        div.textContent = word;
        div.className = 'list-item';
        wordList.appendChild(div);
    });
}

function calculatePHCSimilarity(firstText, secondText, maxAttempts, penaltyFunction, mode = 'full') {
    const dp = new Array(firstText.length + 1).fill(null).map(() => 
        new Array(secondText.length + 1).fill(null).map(() => 
            new Array(maxAttempts).fill(null).map(() => [0, 0])
        )
    );

    const similarity = ([corrects, wrongs]) => {
        if(corrects + wrongs === 0) return 0;
        return corrects / (corrects + wrongs);
    };

    const attempts = maxAttempts - 1;

    for (let i = 1; i <= firstText.length; i++) {
        for (let a = 0; a < maxAttempts; a++) {
            dp[i][0][a][1] = penaltyFunction(maxAttempts - a) + dp[i - 1][0][Math.max(a - 1, 0)][1];
        }
    }
    for (let j = 1; j <= secondText.length; j++) {
        for (let a = 0; a < maxAttempts; a++) {
            dp[0][j][a][1] = penaltyFunction(maxAttempts - a) + dp[0][j - 1][Math.max(a - 1, 0)][1];
        }
    }

    for (let i = 0; i < firstText.length; i++) {
        for (let j = 0; j < secondText.length; j++) {
            for (let a = 0; a < maxAttempts; a++) {
                if (firstText.charAt(i) === secondText.charAt(j)) {
                    dp[i+1][j+1][a][0] = 1 + dp[i][j][attempts][0];
                    dp[i+1][j+1][a][1] = dp[i][j][attempts][1];
                } else {
                    const retry = Math.max(a - 1, 0);
                    const cuts = [];
                    if (mode === 'edit' || mode === 'full') cuts.push(dp[i][j][retry]);
                    if (mode === 'delete' || mode === 'full') cuts.push(dp[i+1][j][retry], dp[i][j+1][retry]);
                    const bestCut = cuts.sort((a, b) => similarity(b) - similarity(a)).shift();
                    dp[i+1][j+1][a][0] = bestCut[0];
                    dp[i+1][j+1][a][1] = penaltyFunction(maxAttempts - a) + bestCut[1];
                }
            }
        }
    }

    return similarity(dp[firstText.length][secondText.length][attempts]);
}

function updateFilteredWords() {
    const comparisonText = document.getElementById('comparisonText').value;
    const clamp = parseInt(document.getElementById('penaltyClamp').value, 10);
    const penaltyFunc = new Function('x', 'return ' + document.getElementById('penaltyFunction').value);
    const threshold = parseFloat(document.getElementById('threshold').value);

    filteredWords.innerHTML = '';
    initialWords.forEach(word => {
        const similarity = calculatePHCSimilarity(word, clamp, penaltyFunc);
        if (similarity >= threshold) {
            const div = document.createElement('div');
            div.textContent = `${word} - ${similarity.toFixed(2)}%`;
            div.className = 'list-item';
            filteredWords.appendChild(div);
        }
    });
}

// Initialize word list and set up event listeners
populateWordList();
document.getElementById('comparisonText').addEventListener('input', updateFilteredWords);
document.getElementById('penaltyClamp').addEventListener('input', updateFilteredWords);
document.getElementById('penaltyFunction').addEventListener('input', updateFilteredWords);
document.getElementById('threshold').addEventListener('input', updateFilteredWords);

</script>
</body>
</html>
